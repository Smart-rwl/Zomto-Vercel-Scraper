<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zomato Follower Scraper</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* Dark gray background */
        }
        .spinner {
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-white flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl bg-gray-800 rounded-xl shadow-2xl p-6 sm:p-8 space-y-6 border border-gray-700">
        <div class="text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-white">Zomato Follower Scraper</h1>
            <p class="text-gray-400 mt-2">Enter a Zomato user profile URL to get their follower links.</p>
        </div>

        <div class="space-y-4">
            <div>
                <label for="zomato-url" class="block text-sm font-medium text-gray-300 mb-2">Zomato Profile URL</label>
                <div class="flex flex-col sm:flex-row gap-3">
                    <input type="url" id="zomato-url" placeholder="https://www.zomato.com/users/..." class="flex-grow bg-gray-700 text-white border-gray-600 rounded-lg w-full px-4 py-3 focus:ring-2 focus:ring-blue-500 focus:outline-none transition duration-200" required>
                    <button id="scrape-btn" class="flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200 w-full sm:w-auto">
                        <i class="fas fa-search mr-2"></i>
                        <span>Scrape Followers</span>
                    </button>
                </div>
            </div>
            <div id="status-container" class="text-center min-h-[20px]"></div>
        </div>

        <div id="results-container" class="hidden">
            <label for="follower-links" class="block text-sm font-medium text-gray-300 mb-2">Scraped Follower Links</label>
            <textarea id="follower-links" rows="10" class="w-full bg-gray-900 text-gray-300 border-gray-700 rounded-lg p-4 focus:ring-2 focus:ring-blue-500 focus:outline-none" readonly></textarea>
            <button id="copy-btn" class="mt-4 w-full flex items-center justify-center bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition duration-200">
                <i class="fas fa-copy mr-2"></i>
                <span id="copy-text">Copy All</span>
            </button>
        </div>
    </div>

    <script>
        const scrapeBtn = document.getElementById('scrape-btn');
        const copyBtn = document.getElementById('copy-btn');
        const urlInput = document.getElementById('zomato-url');
        const resultsContainer = document.getElementById('results-container');
        const followerLinksTextarea = document.getElementById('follower-links');
        const statusContainer = document.getElementById('status-container');
        const copyText = document.getElementById('copy-text');

        scrapeBtn.addEventListener('click', handleScrape);
        copyBtn.addEventListener('click', copyToClipboard);

        async function handleScrape() {
            const url = urlInput.value.trim();
            if (!isValidZomatoUrl(url)) {
                showStatus('Please enter a valid Zomato user profile URL.', 'error');
                return;
            }

            setLoading(true);
            resultsContainer.classList.add('hidden');
            followerLinksTextarea.value = '';

            try {
                // Call our backend serverless function
                const response = await fetch(`/api/scrape?url=${encodeURIComponent(url)}`);

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Scraping failed on the server.');
                }
                
                const data = await response.json();
                const followers = data.followers;
                
                if (followers && followers.length > 0) {
                    followerLinksTextarea.value = followers.join('\n');
                    resultsContainer.classList.remove('hidden');
                    showStatus(`Successfully scraped ${followers.length} follower links.`, 'success');
                } else {
                    showStatus('No followers found. The profile might be private or have no followers.', 'warning');
                }

            } catch (error) {
                console.error('Scraping error:', error);
                showStatus(error.message, 'error');
            } finally {
                setLoading(false);
            }
        }

        function copyToClipboard() {
            if (!followerLinksTextarea.value) return;
            followerLinksTextarea.select();
            followerLinksTextarea.setSelectionRange(0, 99999);
            try {
                document.execCommand('copy');
                copyText.textContent = 'Copied!';
                setTimeout(() => { copyText.textContent = 'Copy All'; }, 2000);
            } catch (err) {
                console.error('Failed to copy: ', err);
                copyText.textContent = 'Failed!';
                setTimeout(() => { copyText.textContent = 'Copy All'; }, 2000);
            }
            window.getSelection().removeAllRanges();
        }

        function isValidZomatoUrl(url) {
            try {
                const urlObject = new URL(url);
                return urlObject.hostname.includes('zomato.com') && urlObject.pathname.includes('/users/');
            } catch (error) {
                return false;
            }
        }
        
        function setLoading(isLoading) {
            if (isLoading) {
                scrapeBtn.disabled = true;
                scrapeBtn.innerHTML = `<div class="spinner w-5 h-5 border-2 border-white border-solid rounded-full"></div> <span class="ml-2">Scraping...</span>`;
                statusContainer.innerHTML = '';
            } else {
                scrapeBtn.disabled = false;
                scrapeBtn.innerHTML = `<i class="fas fa-search mr-2"></i> <span>Scrape Followers</span>`;
            }
        }

        function showStatus(message, type = 'info') {
            let colorClass = 'text-gray-400';
            if (type === 'success') colorClass = 'text-green-400';
            if (type === 'error') colorClass = 'text-red-400';
            if (type === 'warning') colorClass = 'text-yellow-400';
            statusContainer.innerHTML = `<p class="${colorClass} transition-opacity duration-300">${message}</p>`;
        }
    </script>
</body>
</html>
